function vecMake(t,o){var n=[];for(let e=0;e<t;++e)n[e]=o;return n}function vecInit(e){var t=e.split(","),o=[];for(let e=0;e<t.length;++e)o[e]=parseFloat(t[e]);return o}function matMake(e,o,n){var s=[];for(let t=0;t<e;++t){s[t]=[];for(let e=0;e<o;++e)s[t][e]=n}return s}function matInit(e,o,t){var n=matMake(e,o,0),s=t.split(",");let r=0;for(let t=0;t<e;++t)for(let e=0;e<o;++e)n[t][e]=parseFloat(s[r++]);return n}function vecShow(t,o,n){for(let e=0;e<t.length;++e)0<=t[e]&&(t[e],process.stdout.write(" ")),process.stdout.write(x.toFixed(o).padStart(n," "));process.stdout.write("\n")}function matShow(n,s,r){var e=n.length,a=n[0].length;for(let o=0;o<e;++o){for(let t=0;t<a;++t){let e=n[o][t];e<1e-5&&(e=0),process.stdout.write(e.toFixed(s).padStart(r," ")),process.stdout.write("  ")}process.stdout.write("\n")}}function matProduct(n,s){var e=n.length,r=n[0].length,t=s.length,a=s[0].length;if(r!=t)throw"Non-conformable matrices";var l=matMake(e,a,0);for(let o=0;o<e;++o)for(let t=0;t<a;++t)for(let e=0;e<r;++e)l[o][t]+=n[o][e]*s[e][t];return l}function matInverse(o){var n=o.length,s=matMake(n,n,0);for(let t=0;t<n;++t)for(let e=0;e<n;++e)s[t][e]=o[t][e];var e=matMake(n,n,0),r=vecMake(n,0),a=(matDecompose(o,e,r),vecMake(n,0));for(let t=0;t<n;++t){for(let e=0;e<n;++e)t==r[e]?a[e]=1:a[e]=0;var l=reduce(e,a);for(let e=0;e<n;++e)s[e][t]=l[e]}return s}function matDeterminant(e){var t=e.length,o=matMake(t,t,0);let n=matDecompose(e,o,vecMake(t,0));for(let e=0;e<t;++e)n*=o[e][e];return n}function matDecompose(o,s,r){let e=1;var a=o.length;for(let t=0;t<a;++t)for(let e=0;e<a;++e)s[t][e]=o[t][e];for(let e=0;e<a;++e)r[e]=e;for(let n=0;n<a-1;++n){let t=Math.abs(s[n][n]),o=n;for(let e=n+1;e<a;++e){var l=Math.abs(s[e][n]);l>t&&(t=l,o=e)}o!=n&&(i=s[o],s[o]=s[n],s[n]=i,i=r[o],r[o]=r[n],r[n]=i,e=-e);var i,c=s[n][n];if(0!=c)for(let t=n+1;t<a;++t){var d=s[t][n]/c;s[t][n]=d;for(let e=n+1;e<a;++e)s[t][e]-=d*s[n][e]}}return e}function reduce(n,t){var s=n.length,r=vecMake(s,0);for(let e=0;e<s;++e)r[e]=t[e];for(let o=1;o<s;++o){let t=r[o];for(let e=0;e<o;++e)t-=n[o][e]*r[e];r[o]=t}r[s-1]/=n[s-1][s-1];for(let o=s-2;0<=o;--o){let t=r[o];for(let e=o+1;e<s;++e)t-=n[o][e]*r[e];r[o]=t/n[o][o]}return r}function main(){process.stdout.write("[0m"),process.stdout.write("[1m[37m"),console.log("\nBegin matrix inversion using JavaScript demo ");var e=matInit(4,4,"3,7,2,5,4,0,1,1,1,6,3,0,2,8,4,3 "),t=(console.log("\nOriginal matrix m is: "),matShow(e,1,5),matDeterminant(e)),t=(console.log("\nDeterminant of m = "),console.log(t),matInverse(e)),e=(console.log("\nInverse of m is: "),matShow(t,4,8),matProduct(e,t));console.log("\nProduct of m * inv is: "),matShow(e,2,7),process.stdout.write("[0m"),console.log("\nEnd demo")}SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||!function(){function s(e){this._string=e,this._currentIndex=0,this._endIndex=this._string.length,this._prevCommand=null,this._skipOptionalSpaces()}function o(e){if(!e||0===e.length)return[];var t=new s(e),o=[];if(t.initialCommandIsMoveTo())for(;t.hasMoreData();){var n=t.parseSegment();if(null===n)break;o.push(n)}return o}function n(e){return e.map(function(e){return{type:e.type,values:Array.prototype.slice.call(e.values)}})}function l(e){var c=[],d=null,u=null,h=null,m=null,f=null,p=null,v=null;return e.forEach(function(e){var t,o,n,s,r,a,l,i;"M"===e.type?(l=e.values[0],i=e.values[1],c.push({type:"M",values:[l,i]}),m=p=l,f=v=i):"C"===e.type?(a=e.values[0],t=e.values[1],o=e.values[2],n=e.values[3],l=e.values[4],i=e.values[5],c.push({type:"C",values:[a,t,o,n,l,i]}),u=o,h=n,m=l,f=i):"L"===e.type?(l=e.values[0],i=e.values[1],c.push({type:"L",values:[l,i]}),m=l,f=i):"H"===e.type?(l=e.values[0],c.push({type:"L",values:[l,f]}),m=l):"V"===e.type?(i=e.values[0],c.push({type:"L",values:[m,i]}),f=i):"S"===e.type?(o=e.values[0],n=e.values[1],l=e.values[2],i=e.values[3],r="C"===d||"S"===d?(s=m+(m-u),f+(f-h)):(s=m,f),c.push({type:"C",values:[s,r,o,n,l,i]}),u=o,h=n,m=l,f=i):"T"===e.type?(l=e.values[0],i=e.values[1],t="Q"===d||"T"===d?(a=m+(m-u),f+(f-h)):(a=m,f),s=m+2*(a-m)/3,r=f+2*(t-f)/3,c.push({type:"C",values:[s,r,l+2*(a-l)/3,i+2*(t-i)/3,l,i]}),u=a,h=t,m=l,f=i):"Q"===e.type?(a=e.values[0],t=e.values[1],l=e.values[2],i=e.values[3],s=m+2*(a-m)/3,r=f+2*(t-f)/3,c.push({type:"C",values:[s,r,l+2*(a-l)/3,i+2*(t-i)/3,l,i]}),u=a,h=t,m=l,f=i):"A"===e.type?(o=Math.abs(e.values[0]),n=Math.abs(e.values[1]),s=e.values[2],r=e.values[3],a=e.values[4],l=e.values[5],i=e.values[6],0===o||0===n?(c.push({type:"C",values:[m,f,l,i,l,i]}),m=l,f=i):m===l&&f===i||(I(m,f,l,i,o,n,s,r,a).forEach(function(e){c.push({type:"C",values:e})}),m=l,f=i)):"Z"===e.type&&(c.push(e),m=p,f=v),d=e.type}),c}var r={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},a=-1!==window.navigator.userAgent.indexOf("MSIE "),i=(s.prototype={parseSegment:function(){var e=this._string[this._currentIndex],t=r[e]||null;if(null===t){if(null===this._prevCommand)return null;if(null===(t=("+"===e||"-"===e||"."===e||"0"<=e&&e<="9")&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null))return null}else this._currentIndex+=1;var e=null,o=(this._prevCommand=t).toUpperCase();return"H"===o||"V"===o?e=[this._parseNumber()]:"M"===o||"L"===o||"T"===o?e=[this._parseNumber(),this._parseNumber()]:"S"===o||"Q"===o?e=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:"C"===o?e=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:"A"===o?e=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()]:"Z"===o&&(this._skipOptionalSpaces(),e=[]),null===e||0<=e.indexOf(null)?null:{type:t,values:e}},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var e=this._string[this._currentIndex];return r[e]||null},initialCommandIsMoveTo:function(){var e;return!this.hasMoreData()||"M"===(e=this.peekSegmentType())||"m"===e},_isCurrentSpace:function(){var e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string[this._currentIndex])&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]&&(this._currentIndex+=1,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},_parseNumber:function(){var e=0,t=0,o=1,n=0,s=1,r=1,a=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex]?this._currentIndex+=1:this._currentIndex<this._endIndex&&"-"===this._string[this._currentIndex]&&(this._currentIndex+=1,s=-1),this._currentIndex===this._endIndex||(this._string[this._currentIndex]<"0"||"9"<this._string[this._currentIndex])&&"."!==this._string[this._currentIndex])return null;for(var l=this._currentIndex;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&this._string[this._currentIndex]<="9";)this._currentIndex+=1;if(this._currentIndex!==l)for(var i=this._currentIndex-1,c=1;l<=i;)t+=c*(this._string[i]-"0"),--i,c*=10;if(this._currentIndex<this._endIndex&&"."===this._string[this._currentIndex]){if(this._currentIndex+=1,this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&this._string[this._currentIndex]<="9";)o*=10,n+=(this._string.charAt(this._currentIndex)-"0")/o,this._currentIndex+=1}if(this._currentIndex!==a&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){if(this._currentIndex+=1,"+"===this._string[this._currentIndex]?this._currentIndex+=1:"-"===this._string[this._currentIndex]&&(this._currentIndex+=1,r=-1),this._currentIndex>=this._endIndex||this._string[this._currentIndex]<"0"||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&this._string[this._currentIndex]<="9";)e=(e*=10)+(this._string[this._currentIndex]-"0"),this._currentIndex+=1}var d=t+n;return d*=s,e&&(d*=Math.pow(10,r*e)),a===this._currentIndex?null:(this._skipOptionalSpacesOrDelimiter(),d)},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var e=null,t=this._string[this._currentIndex];if(this._currentIndex+=1,"0"===t)e=0;else{if("1"!==t)return null;e=1}return this._skipOptionalSpacesOrDelimiter(),e}},SVGPathElement.prototype.setAttribute),c=SVGPathElement.prototype.removeAttribute,m=window.Symbol?Symbol():"__cachedPathData",f=window.Symbol?Symbol():"__cachedNormalizedPathData",I=function(e,t,o,n,s,r,a,l,i,c){function d(e,t,o){return{x:e*Math.cos(o)-t*Math.sin(o),y:e*Math.sin(o)+t*Math.cos(o)}}var u=Math.PI*a/180,h=[],m=(c?(g=c[0],b=c[1],y=c[2],T=c[3]):(e=(p=d(e,t,-u)).x,t=p.y,1<(m=(f=(e-(o=(p=d(o,n,-u)).x))/2)*f/(s*s)+(p=(t-(n=p.y))/2)*p/(r*r))&&(s*=m=Math.sqrt(m),r*=m),m=s*s,v=r*r,y=(l=(l===i?-1:1)*Math.sqrt(Math.abs((m*v-m*p*p-v*f*f)/(m*p*p+v*f*f))))*s*p/r+(e+o)/2,T=l*-r*f/s+(t+n)/2,g=Math.asin(parseFloat(((t-T)/r).toFixed(9))),b=Math.asin(parseFloat(((n-T)/r).toFixed(9))),e<y&&(g=Math.PI-g),o<y&&(b=Math.PI-b),g<0&&(g=2*Math.PI+g),b<0&&(b=2*Math.PI+b),i&&b<g&&(g-=2*Math.PI),!i&&g<b&&(b-=2*Math.PI)),b-g),f=(Math.abs(m)>120*Math.PI/180&&(v=b,p=o,l=n,b=i&&g<b?g+120*Math.PI/180*1:g+120*Math.PI/180*-1,o=y+s*Math.cos(b),n=T+r*Math.sin(b),h=I(o,n,p,l,s,r,a,0,i,[b,v,y,T])),m=b-g,Math.cos(g)),p=Math.sin(g),l=Math.cos(b),a=Math.sin(b),i=Math.tan(m/4),v=4/3*s*i,y=4/3*r*i,T=[e,t],g=[e+v*p,t-y*f],b=[o+v*a,n-y*l],m=[o,n];if(g[0]=2*T[0]-g[0],g[1]=2*T[1]-g[1],c)return[g,b,m].concat(h);for(var h=[g,b,m].concat(h),x=[],w=0;w<h.length;w+=3){var s=d(h[w][0],h[w][1],u),r=d(h[w+1][0],h[w+1][1],u),E=d(h[w+2][0],h[w+2][1],u);x.push([s.x,s.y,r.x,r.y,E.x,E.y])}return x};SVGPathElement.prototype.setAttribute=function(e,t){"d"===e&&(this[m]=null,this[f]=null),i.call(this,e,t)},SVGPathElement.prototype.removeAttribute=function(e,t){"d"===e&&(this[m]=null,this[f]=null),c.call(this,e)},SVGPathElement.prototype.getPathData=function(e){var t,i,c,d,u,h;return e&&e.normalize?this[f]?n(this[f]):(this[m]?t=n(this[m]):(t=o(this.getAttribute("d")||""),this[m]=n(t)),e=l((i=[],h=u=d=c=null,t.forEach(function(e){var t,o,n,s,r,a,l=e.type;"M"===l?(r=e.values[0],a=e.values[1],i.push({type:"M",values:[r,a]}),c=u=r,d=h=a):"m"===l?(r=c+e.values[0],a=d+e.values[1],i.push({type:"M",values:[r,a]}),c=u=r,d=h=a):"L"===l?(r=e.values[0],a=e.values[1],i.push({type:"L",values:[r,a]}),c=r,d=a):"l"===l?(r=c+e.values[0],a=d+e.values[1],i.push({type:"L",values:[r,a]}),c=r,d=a):"C"===l?(t=e.values[0],o=e.values[1],n=e.values[2],s=e.values[3],r=e.values[4],a=e.values[5],i.push({type:"C",values:[t,o,n,s,r,a]}),c=r,d=a):"c"===l?(t=c+e.values[0],o=d+e.values[1],n=c+e.values[2],s=d+e.values[3],r=c+e.values[4],a=d+e.values[5],i.push({type:"C",values:[t,o,n,s,r,a]}),c=r,d=a):"Q"===l?(t=e.values[0],o=e.values[1],r=e.values[2],a=e.values[3],i.push({type:"Q",values:[t,o,r,a]}),c=r,d=a):"q"===l?(t=c+e.values[0],o=d+e.values[1],r=c+e.values[2],a=d+e.values[3],i.push({type:"Q",values:[t,o,r,a]}),c=r,d=a):"A"===l?(r=e.values[5],a=e.values[6],i.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],r,a]}),c=r,d=a):"a"===l?(r=c+e.values[5],a=d+e.values[6],i.push({type:"A",values:[e.values[0],e.values[1],e.values[2],e.values[3],e.values[4],r,a]}),c=r,d=a):"H"===l?(r=e.values[0],i.push({type:"H",values:[r]}),c=r):"h"===l?(r=c+e.values[0],i.push({type:"H",values:[r]}),c=r):"V"===l?(a=e.values[0],i.push({type:"V",values:[a]}),d=a):"v"===l?(a=d+e.values[0],i.push({type:"V",values:[a]}),d=a):"S"===l?(n=e.values[0],s=e.values[1],r=e.values[2],a=e.values[3],i.push({type:"S",values:[n,s,r,a]}),c=r,d=a):"s"===l?(n=c+e.values[0],s=d+e.values[1],r=c+e.values[2],a=d+e.values[3],i.push({type:"S",values:[n,s,r,a]}),c=r,d=a):"T"===l?(r=e.values[0],a=e.values[1],i.push({type:"T",values:[r,a]}),c=r,d=a):"t"===l?(r=c+e.values[0],a=d+e.values[1],i.push({type:"T",values:[r,a]}),c=r,d=a):"Z"!==l&&"z"!==l||(i.push({type:"Z",values:[]}),c=u,d=h)}),i)),this[f]=n(e),e):this[m]?n(this[m]):(t=o(this.getAttribute("d")||""),this[m]=n(t),t)},SVGPathElement.prototype.setPathData=function(e){if(0===e.length)a?this.setAttribute("d",""):this.removeAttribute("d");else{for(var t="",o=0,n=e.length;o<n;o+=1){var s=e[o];0<o&&(t+=" "),t+=s.type,s.values&&0<s.values.length&&(t+=" "+s.values.join(" "))}this.setAttribute("d",t)}},SVGRectElement.prototype.getPathData=function(e){var t=this.x.baseVal.value,o=this.y.baseVal.value,n=this.width.baseVal.value,s=this.height.baseVal.value,r=(this.hasAttribute("rx")?this.rx:this.ry).baseVal.value,a=(this.hasAttribute("ry")?this.ry:this.rx).baseVal.value,n=(n=[{type:"M",values:[t+(r=n/2<r?n/2:r),o]},{type:"H",values:[t+n-r]},{type:"A",values:[r,a=s/2<a?s/2:a,0,0,1,t+n,o+a]},{type:"V",values:[o+s-a]},{type:"A",values:[r,a,0,0,1,t+n-r,o+s]},{type:"H",values:[t+r]},{type:"A",values:[r,a,0,0,1,t,o+s-a]},{type:"V",values:[o+a]},{type:"A",values:[r,a,0,0,1,t+r,o]},{type:"Z",values:[]}]).filter(function(e){return"A"!==e.type||0!==e.values[0]&&0!==e.values[1]});return n=e&&!0===e.normalize?l(n):n},SVGCircleElement.prototype.getPathData=function(e){var t=this.cx.baseVal.value,o=this.cy.baseVal.value,n=this.r.baseVal.value,t=[{type:"M",values:[t+n,o]},{type:"A",values:[n,n,0,0,1,t,o+n]},{type:"A",values:[n,n,0,0,1,t-n,o]},{type:"A",values:[n,n,0,0,1,t,o-n]},{type:"A",values:[n,n,0,0,1,t+n,o]},{type:"Z",values:[]}];return t=e&&!0===e.normalize?l(t):t},SVGEllipseElement.prototype.getPathData=function(e){var t=this.cx.baseVal.value,o=this.cy.baseVal.value,n=this.rx.baseVal.value,s=this.ry.baseVal.value,s=[{type:"M",values:[t+n,o]},{type:"A",values:[n,s,0,0,1,t,o+s]},{type:"A",values:[n,s,0,0,1,t-n,o]},{type:"A",values:[n,s,0,0,1,t,o-s]},{type:"A",values:[n,s,0,0,1,t+n,o]},{type:"Z",values:[]}];return s=e&&!0===e.normalize?l(s):s},SVGLineElement.prototype.getPathData=function(){return[{type:"M",values:[this.x1.baseVal.value,this.y1.baseVal.value]},{type:"L",values:[this.x2.baseVal.value,this.y2.baseVal.value]}]},SVGPolylineElement.prototype.getPathData=function(){for(var e=[],t=0;t<this.points.numberOfItems;t+=1){var o=this.points.getItem(t);e.push({type:0===t?"M":"L",values:[o.x,o.y]})}return e},SVGPolygonElement.prototype.getPathData=function(){for(var e=[],t=0;t<this.points.numberOfItems;t+=1){var o=this.points.getItem(t);e.push({type:0===t?"M":"L",values:[o.x,o.y]})}return e.push({type:"Z",values:[]}),e}}(),Minitpl=function(){function e(e,t){if(this.elem="string"==typeof e?document.querySelector(e):e,!e)throw"Invalid element!";this.parent=this.elem.parentNode,this.parent.removeChild(this.elem)}function r(e,t){"function"==typeof t?t(e):e.textContent=t}return e.prototype.add=function(e){var t=this.elem.cloneNode(!0);if("object"==typeof e)for(var o in e)for(var n=t.querySelectorAll(o),s=0;s<n.length;s++)r(n[s],e[o]);else r(t,e);return this.parent.appendChild(t),t},e}(),SVGGraphicsElement.prototype.transformedBBox&&SVGGraphicsElement.prototype.transformedBBoxContains||([pointInTransformedBBox,transformedBBoxIntersects]=function(){function t(e){for(var t=null,o=0;o<e.transform.baseVal.numberOfItems;++o){var n=e.transform.baseVal[o];if(n.type===SVGTransform.SVG_TRANSFORM_MATRIX){t=n;break}}return null==t&&(t=e.transform.baseVal.createSVGTransformFromMatrix(Tools.svg.createSVGMatrix()),e.transform.baseVal.appendItem(t)),t.matrix}function o(e,t){return[e.a*t[0]+e.c*t[1],e.b*t[0]+e.d*t[1]]}function n(e,t){return[e.a*t[0]+e.c*t[1]+e.e,e.b*t[0]+e.d*t[1]+e.f]}function s([e,t],{r:o,a:n,b:s}){return e=[e-o[0],t-o[1]],t=n[0]*s[1]-n[1]*s[0],o=(e[0]*s[1]-e[1]*s[0])/t,s=(e[1]*n[0]-e[0]*n[1])/t,0<=o&&o<=1&&0<=s&&s<=1}SVGGraphicsElement.prototype.transformedBBox=function(e=1){return bbox=this.getBBox(),(tmatrix=t(this)).e/=e,tmatrix.f/=e,{r:n(tmatrix,[bbox.x/e,bbox.y/e]),a:o(tmatrix,[bbox.width/e,0]),b:o(tmatrix,[0,bbox.height/e])}},SVGSVGElement.prototype.transformedBBox=function(e=1){return bbox={x:this.x.baseVal.value,y:this.y.baseVal.value,width:this.width.baseVal.value,height:this.height.baseVal.value},(tmatrix=t(this)).e/=e,tmatrix.f/=e,{r:n(tmatrix,[bbox.x/e,bbox.y/e]),a:o(tmatrix,[bbox.width/e,0]),b:o(tmatrix,[0,bbox.height/e])}};function r(t,e){return[e.r,[e.r[0]+e.a[0],e.r[1]+e.a[1]],[e.r[0]+e.b[0],e.r[1]+e.b[1]],[e.r[0]+e.a[0]+e.b[0],e.r[1]+e.a[1]+e.b[1]]].every(function(e){return s(e,t)})}return SVGGraphicsElement.prototype.transformedBBoxContains=function(e,t){return s([e,t],this.transformedBBox())},SVGGraphicsElement.prototype.transformedBBoxIntersects=function(e){return r(this.transformedBBox(),e)},[s,r]}());var Matrix={},canvascolor=function(){"use strict";var g,e,t;function o(o){var n=o.value||"#000",l=200,i=l/2,s=g.cloneNode(!0),r=(s.style.width=l+"px",s.style.position=function(e){do{if("fixed"===getComputedStyle(e).position)return 1}while(null!==(e=e.parentElement))}(o)?"fixed":"absolute",s.getElementsByTagName("canvas")[0]),e=r.getContext("2d"),a=(r.width=l,r.height=i,s.getElementsByClassName("canvascolor-history")[0]),c=(a.style.width=l+"px",a.style.maxHeight=i+"px",y(n));c.style.border="1px solid white",c.style.borderRadius="5px",document.body.appendChild(s),o.addEventListener("mouseover",function(){var e=(t=o.getBoundingClientRect()).top+t.height+3,t=t.left;"fixed"!==s.style.position&&(e+=document.documentElement.scrollTop,t+=document.documentElement.scrollLeft),s.style.top=e+"px",s.style.left=t+"px",s.style.display="block"},!0),s.addEventListener("mouseleave",function(){s.style.display="none"},!1),o.addEventListener("keyup",function(){v(o.value,!0)},!0),v(o.value,!0);var t=e.createImageData(l,i);function d(e){function t(e){return(15*e/255|0).toString(16)}return"#"+t(e[0])+t(e[1])+t(e[2])}function u(e){var t=e[0],e=e[1],t=t/l*Math.PI,o=1,n=255*(1-e/i);if(0===o)return[n,n,n];var e=0|(t/=Math.PI/6),s=n*(1-o),r=n*(1-o*(t=t-e)),a=n*(1-o*(1-t));switch(e%6){case 0:return[n,a,s];case 1:return[r,n,s];case 2:return[s,n,a];case 3:return[s,r,n];case 4:return[a,s,n];case 5:return[n,s,r]}}for(var h=0;h<l;h++)for(var m=0;m<i;m++){var f=4*(h+m*l),p=u([h,m]);t.data[f]=p[0],t.data[1+f]=p[1],t.data[2+f]=p[2],t.data[3+f]=255}function v(e,t){o.style.backgroundColor=e,t&&0===o.style.backgroundColor.length?o.style.backgroundColor=n:(c.style.backgroundColor=e,n=e,o.value=e,o.focus())}function y(e){var t=document.createElement("div");return t.style.width=l/3-10+"px",t.style.height=i/3-8+"px",t.style.backgroundColor=e,t.addEventListener("click",function(){v(e)},!0),a.childElementCount<=1?a.appendChild(t):a.insertBefore(t,a.children[1]),t}function T(e){var t=r.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]}e.putImageData(t,0,0),r.addEventListener("mousemove",function(e){e=T(e);c.style.backgroundColor=d(u(e))},!0),r.addEventListener("click",function(e){e=d(u(T(e)));y(e),v(e)},!0),r.addEventListener("mouseleave",function(){c.style.backgroundColor=n},!0)}(e=document.createElement("style")).innerHTML=[".canvascolor-container{","background-color:black;","border-radius:5px;","overflow:hidden;","width:179px;","padding:2px;","display:none;","}",".canvascolor-container canvas{","cursor:crosshair;","}",".canvascolor-history{","overflow:auto;","}",".canvascolor-history > div{","margin:2px;","display:inline-block;","}"].join(""),document.head.appendChild(e),(g=document.createElement("div")).className="canvascolor-container",e=document.createElement("canvas"),(t=document.createElement("div")).className="canvascolor-history",g.appendChild(e),g.appendChild(t);for(var n=document.querySelectorAll("input.canvascolor, input[type=color]"),s=0;s<n.length;s++){var r=n.item(s);"color"===r.type&&-1===r.className.split(" ").indexOf("canvascolor")||o(r)}return o}(),Tools={};function saveBoardNametoLocalStorage(){var t=Tools.boardName;if("anonymous"!==t.toLowerCase()){var o,e="recent-boards";try{if(o=JSON.parse(localStorage.getItem(e)),!Array.isArray(o))throw new Error("Invalid type")}catch(e){o=[],console.log("Board history loading error",e)}(o=o.filter(function(e){return e!==t})).unshift(t),o=o.slice(0,20),localStorage.setItem(e,JSON.stringify(o))}}function messageForTool(e){var t=e.tool,o=Tools.list[t];o?(Tools.applyHooks(Tools.messageHooks,e),o.draw(e,!1)):Tools.pendingMessages[t]?Tools.pendingMessages[t].push(e):Tools.pendingMessages[t]=[e],"Hand"!==e.tool&&null!=e.transform&&messageForTool({tool:"Hand",type:"update",transform:e.transform,id:e.id})}function batchCall(e,t){var o;return 0===t.length?Promise.resolve():(o=t.slice(0,1024),t=t.slice(1024),Promise.all(o.map(e)).then(function(){return new Promise(requestAnimationFrame)}).then(batchCall.bind(null,e,t)))}function handleMessage(e){return e.tool||e._children,e.userCount&&updateUserCount(e.userCount),e.tool&&messageForTool(e),e._children?batchCall(handleMessage,e._children):Promise.resolve()}function updateUserCount(e){document.getElementById("usercount").textContent=e}function updateDocumentTitle(){document.title=(Tools.unreadMessagesCount?"("+Tools.unreadMessagesCount+") ":"")+Tools.boardName+" | WBO"}function resizeCanvas(e){var t=0|e.x,e=0|e.y,o=Tools.server_config.MAX_BOARD_SIZE||65536;t>Tools.svg.width.baseVal.value-2e3&&(Tools.svg.width.baseVal.value=Math.min(2e3+t,o)),e>Tools.svg.height.baseVal.value-2e3&&(Tools.svg.height.baseVal.value=Math.min(2e3+e,o))}function updateUnreadCount(e){document.hidden&&-1===["child","update"].indexOf(e.type)&&Tools.newUnreadMessage()}Tools.i18n=function(){var o=JSON.parse(document.getElementById("translations").text);return{t:function(e){var t=e.toLowerCase().replace(/ /g,"_");return o[t]||e}}}(),Tools.server_config=JSON.parse(document.getElementById("configuration").text),Tools.board=document.getElementById("board"),Tools.svg=document.getElementById("canvas"),Tools.drawingArea=Tools.svg.getElementById("drawingArea"),Tools.curTool=null,Tools.drawingEvent=!0,Tools.showMarker=!0,Tools.showOtherCursors=!0,Tools.showMyCursor=!0,Tools.hideSelectionUI=null,Tools.isIE=/MSIE|Trident/.test(window.navigator.userAgent),Tools.socket=null,Tools.connect=function(){this.socket&&(this.socket.destroy(),delete this.socket,this.socket=null),this.socket=io.connect("",{path:window.location.pathname.split("/boards/")[0]+"/socket.io",reconnection:!0,reconnectionDelay:100,timeout:12e5}),this.socket.on("broadcast",function(e){handleMessage(e).finally(function(){document.getElementById("loadingMessage").classList.add("hidden")})}),this.socket.on("addActionToHistory",function(e){Tools.addActionToHistory(e,!0)}),this.socket.on("addActionToHistoryRedo",function(e){Tools.addActionToHistoryRedo(e,!0)}),this.socket.on("reconnect",function(){Tools.socket.emit("joinboard",Tools.boardName)})},Tools.connect(),Tools.boardName=function(){var e=window.location.pathname.split("/");return decodeURIComponent(e[e.length-1])}(),Tools.socket.emit("getboard",Tools.boardName),window.addEventListener("pageshow",saveBoardNametoLocalStorage),Tools.HTML={template:new Minitpl("#tools > .tool"),addShortcut:function(t,o){window.addEventListener("keydown",function(e){e.key!==t||e.target.matches("input[type=text], textarea")||o()})},addTool:function(o,n,e,s,r){function a(){Tools.change(o)}return this.addShortcut(s,function(){Tools.change(o),document.activeElement.blur&&document.activeElement.blur()}),this.template.add(function(e){e.addEventListener("click",a),e.id="toolID-"+o,e.getElementsByClassName("tool-name")[0].textContent=Tools.i18n.t(o);var t=e.getElementsByClassName("tool-icon")[0];t.src=n,t.alt=n,r&&e.classList.add("oneTouch"),e.title=Tools.i18n.t(o)+" ("+Tools.i18n.t("keyboard shortcut")+": "+s+")"+(Tools.list[o].secondary?" ["+Tools.i18n.t("click_to_toggle")+"]":"")})},changeTool:function(e,t){e=document.getElementById("toolID-"+e),t=document.getElementById("toolID-"+t);e&&e.classList.remove("curTool"),t&&t.classList.add("curTool")},toggle:function(e,t,o){e=document.getElementById("toolID-"+e);e.getElementsByClassName("tool-icon")[0].src=o,e.getElementsByClassName("tool-name")[0].textContent=Tools.i18n.t(t)},addStylesheet:function(e){var t=document.createElement("link");t.href=e,t.rel="stylesheet",t.type="text/css",document.head.appendChild(t)},colorPresetTemplate:new Minitpl("#colorPresetSel .colorPresetButton"),addColorButton:function(o){var n=Tools.setColor.bind(Tools,o.color);return o.key&&this.addShortcut(o.key,n),this.colorPresetTemplate.add(function(e){var t;e.addEventListener("click",n),e.id="color_"+o.color.replace(/^#/,""),e.style.backgroundColor=o.color,o.color===Tools.currentColor&&((t=document.createElement("img")).id="tick-icon-clr",t.setAttribute("src","/SvgIcons/tick.svg"),e?.appendChild(t)),o.key&&(e.title=Tools.i18n.t("keyboard shortcut")+": "+o.key)})}},Tools.list={},Tools.isBlocked=function(e){if(e.name.includes(","))throw new Error("Tool Names must not contain a comma");return Tools.server_config.BLOCKED_TOOLS.includes(e.name)},Tools.register=function(e){if(!Tools.isBlocked(e)){e.name in Tools.list&&console.log("Tools.add: The tool '"+e.name+"' is alreadyin the list. Updating it..."),Tools.applyHooks(Tools.toolHooks,e),(Tools.list[e.name]=e).onSizeChange&&Tools.sizeChangeHandlers.push(e.onSizeChange);var t,o=Tools.pendingMessages[e.name];if(o)for(console.log("Drawing pending messages for '%s'.",e.name);t=o.shift();)e.draw(t,!1)}},Tools.add=function(e){Tools.isBlocked(e)||(Tools.register(e),e.stylesheet&&Tools.HTML.addStylesheet(e.stylesheet),Tools.HTML.addTool(e.name,e.icon,e.iconHTML,e.shortcut,e.oneTouch))},Tools.change=function(e){var t=Tools.list[e],o=Tools.curTool;if(!t)throw new Error("Trying to select a tool that has never been added!");if(t===o)t.secondary&&(t.secondary.active=!t.secondary.active,n=t.secondary.active?t.secondary:t,Tools.HTML.toggle(t.name,n.name,n.icon),t.secondary.switch)&&t.secondary.switch();else{if(!t.oneTouch){var n=Tools.curTool?Tools.curTool.name:"";try{Tools.HTML.changeTool(n,e)}catch(e){console.error("Unable to update the GUI with the new tool. "+e)}if(Tools.svg.style.cursor=t.mouseCursor||"auto",Tools.board.title=Tools.i18n.t(t.helpText||""),null!==Tools.curTool){if(t===Tools.curTool)return;Tools.removeToolListeners(Tools.curTool),Tools.curTool.onquit(t)}Tools.addToolListeners(t),Tools.curTool=t}t.onstart(o)}},Tools.addToolListeners=function(e){for(var t in e.compiledListeners){var o=e.compiledListeners[t];(o.target||Tools.board).addEventListener(t,o,{passive:!1})}},Tools.removeToolListeners=function(e){for(var t in e.compiledListeners){var o=e.compiledListeners[t],n=o.target||Tools.board;n.removeEventListener(t,o),Tools.isIE&&n.removeEventListener(t,o,!0)}},function(){function e(e,t){!["Straight line","Pencil"].includes(Tools.curTool.name)&&16===t.keyCode&&Tools.curTool.secondary&&Tools.curTool.secondary.active!==e&&Tools.change(Tools.curTool.name)}window.addEventListener("keydown",e.bind(null,!0)),window.addEventListener("keyup",e.bind(null,!1))}(),Tools.send=function(e,t){t=t||Tools.curTool.name;e.tool=t,Tools.applyHooks(Tools.messageHooks,e),t={board:Tools.boardName,data:e};Tools.socket.emit("broadcast",t)},Tools.drawAndSend=function(e,t){(t=null==t?Tools.curTool:t).draw(e,!0),Tools.send(e,t.name)},Tools.pendingMessages={},Tools.unreadMessagesCount=0,Tools.newUnreadMessage=function(){Tools.unreadMessagesCount++,updateDocumentTitle()},window.addEventListener("focus",function(){Tools.unreadMessagesCount=0,updateDocumentTitle()}),function(){var n,s=Date.now();function e(){var e=window.location.hash.slice(1).split(","),t=0|e[0],o=0|e[1],e=parseFloat(e[2]);resizeCanvas({x:t,y:o}),Tools.setScale(e),window.scrollTo(t*e,o*e)}window.addEventListener("scroll",function(){var e=Tools.getScale(),t=document.documentElement.scrollLeft/e,o=document.documentElement.scrollTop/e;clearTimeout(n),n=setTimeout(function(){var e="#"+(0|t)+","+(0|o)+","+Tools.getScale().toFixed(1);5e3<Date.now()-s&&e!==window.location.hash?(window.history.pushState({},"",e),s=Date.now()):window.history.replaceState({},"",e)},100)}),document.getElementById("scalingCenter").addEventListener("click",function e(t,o){var n=t.scale,o=Tools.setScale(o);window.scrollTo(t.scrollX+t.x*(o-n),t.scrollY+t.y*(o-n)),e(s,1);const s={scrollX:document.documentElement.scrollLeft,scrollY:document.documentElement.scrollTop,x:0,y:0,clientY:0,scale:1}},!1),document.getElementById("scalingFull").addEventListener("click",function(){Tools.setScale(1)},!1),document.getElementById("minusScale").addEventListener("click",function(){Tools.setScale(Tools.getScale()-.1)},!1),document.getElementById("plusScale").addEventListener("click",function(){Tools.setScale(Tools.getScale()+.1)},!1),document.getElementById("clearBoard").addEventListener("click",function(){confirm("Are you sure?")&&(Tools.drawAndSend({type:"clearBoard",id:""},Tools.list.Eraser),Tools.historyRedo.splice(0,Tools.historyRedo.length),Tools.history.splice(0,Tools.history.length),Tools.disableToolsEl("undo"),Tools.disableToolsEl("redo"),Tools.change("Hand"),Tools.drawingArea.innerHTML="")},!1),window.addEventListener("hashchange",e,!1),window.addEventListener("popstate",e,!1),window.addEventListener("DOMContentLoaded",e,!1)}(),Tools.messageHooks=[resizeCanvas,updateUnreadCount],Tools.scale=1;var scaleTimeout=null;function _drawLine(e){Tools.drawAndSend({type:"line",id:e.id,color:e.color,size:e.size,opacity:e.opacity,dotted:e.dotted,transform:e.transform},Tools.list.Pencil);for(var t of e._children)Tools.drawAndSend({type:"child",parent:e.id,tool:"Pencil",x:t.x,y:t.y},Tools.list.Pencil)}Tools.setScale=function(e){var t=Math.max(window.innerWidth,window.innerHeight)/Tools.server_config.MAX_BOARD_SIZE,t=Math.max(.67,t);return isNaN(e)&&(e=1),e=Math.max(t,Math.min(2,e)),Tools.svg.style.willChange="transform",Tools.svg.style.transform="scale("+e+")",clearTimeout(scaleTimeout),scaleTimeout=setTimeout(function(){Tools.svg.style.willChange="auto"},1e3),Tools.scale=e,document.getElementById("scaleValue").innerText=Math.round(100*e)+"%",e},Tools.getScale=function(){return Tools.scale},Tools.toolHooks=[function(e){if("string"!=typeof e.name)throw"A tool must have a name";"object"!=typeof e.listeners&&(e.listeners={}),"function"!=typeof e.onstart&&(e.onstart=function(){}),"function"!=typeof e.onquit&&(e.onquit=function(){})},function(e){var t=e.listeners,o=e.compiledListeners||{};function n(n){return function(e){var t=e.pageX/Tools.getScale(),o=e.pageY/Tools.getScale();return n(t,o,e,!1)}}function s(n){return function(e){var t,o;return 1!==e.changedTouches.length||(t=(o=e.changedTouches[0]).pageX/Tools.getScale(),o=o.pageY/Tools.getScale(),n(t,o,e,!0))}}function r(t){return function(e){return document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),t(e)}}e.compiledListeners=o,t.press&&(o.mousedown=r(n(t.press),e.name),o.touchstart=r(s(t.press),e.name)),t.move&&(o.mousemove=n(t.move),o.touchmove=s(t.move)),t.release&&(e=n(t.release),t=s(t.release),o.mouseup=e,Tools.isIE||(o.mouseleave=e),o.touchleave=t,o.touchend=t,o.touchcancel=t)}],Tools.applyHooks=function(e,t){e.forEach(function(e){e(t)})},Tools.generateUID=function(e,t){var o=Date.now().toString(26);return o+=Math.round(1e10*Math.random()).toString(36),e&&(o=e+o),t&&(o+=t),o},Tools.createSVGElement=function(e,o){var n=document.createElementNS(Tools.svg.namespaceURI,e);return"object"==typeof o&&Object.keys(o).forEach(function(e,t){n.setAttributeNS(null,e,o[e])}),n},Tools.positionElement=function(e,t,o){e.style.top=o+"px",e.style.left=t+"px"},Tools.colorPresets=[{color:"#001f3f",key:"1"},{color:"#FF4136",key:"2"},{color:"#0074D9",key:"3"},{color:"#FFFFFF",key:"4"},{color:"#3D9970",key:"5"},{color:"#E65194"}],Tools.currentColor=Tools.colorPresets[0].color,Tools.setColor=function(e){var t=document.getElementById("color_"+Tools.currentColor?.substring(1)),t=(t&&(t.innerHTML=""),document.createElement("img")),o=(t.id="tick-icon-clr",document.getElementById("color_"+e.substring(1)));t.setAttribute("src","/SvgIcons/tick.svg"),o?.appendChild(t),Tools.currentColor=e},Tools.getColor=function(){var e=Math.random()*Tools.colorPresets.length|0,e=Tools.colorPresets[e].color;return Tools.setColor(e),function(){return Tools.currentColor}}(),Tools.colorPresets.forEach(Tools.HTML.addColorButton.bind(Tools.HTML)),Tools.disableToolsEl=function(e){document.getElementById(e).classList.add("disabled")},Tools.enableToolsEl=function(e){document.getElementById(e).classList.remove("disabled")},Tools.sizeChangeHandlers=[],Tools.setSize=function(){var o=document.getElementById("chooseSize");const e=document.getElementById("sizeValue"),t=document.getElementById("size-list");var n=(Tools.server_config.MINIMAL_LINE_WIDTH+Tools.server_config.MAX_LINE_WIDTH)/2,n=[Tools.server_config.MINIMAL_LINE_WIDTH,(Tools.server_config.MINIMAL_LINE_WIDTH+n)/2,n,(n+Tools.server_config.MAX_LINE_WIDTH)/2,Tools.server_config.MAX_LINE_WIDTH],s=document.getElementById("sizeListElement");function r(){var t=Math.max(1,Math.min(50,0|o.value));o.value=t,e.innerText=t,Tools.sizeChangeHandlers.forEach(function(e){e(t)})}return o.setAttribute("min",Tools.server_config.MINIMAL_LINE_WIDTH),o.setAttribute("max",Tools.server_config.MAX_LINE_WIDTH),n.forEach(e=>{t.insertAdjacentHTML("beforeend",`<span class="size-item">${Math.round(e)}</span>`)}),t.addEventListener("click",function(e){e.stopPropagation(),e.target.classList.contains("size-item")&&Tools.setSize(+e.target.innerText)}),s.addEventListener("click",function(e){e.preventDefault(),"chooseSize"!==e.target.id&&(o.classList.contains("hide")?o.classList.remove("hide"):o.classList.add("hide"))}),s.addEventListener("mouseleave",function(){o.classList.remove("hide")}),r(),o.onchange=o.oninput=r,function(e){return null!=e&&(o.value=e,r()),parseInt(o.value)}}(),Tools.getSize=function(){return Tools.setSize()},Tools.getOpacity=function(){var e=document.getElementById("chooseOpacity"),t=document.getElementById("opacityIndicator");function o(){t.setAttribute("opacity",e.value)}return o(),e.onchange=e.oninput=o,function(){return Math.max(.1,Math.min(1,e.value))}}(),Tools.undo=function(){const r=document.getElementById("undo");async function e(){if(!r.className.includes("disabled")&&(Tools.disableToolsEl("undo"),Tools.disableToolsEl("redo"),Tools.history.length)){Tools.hideSelectionUI&&Tools.hideSelectionUI();var e=Tools.history.pop(),t=(0===Tools.history.length&&Tools.disableToolsEl("undo"),null);switch(e.type){case"array":if("delete"===e.events[0].type)t=Tools.list.Eraser,e.sendBack=!0,e.sendToRedo=!0,Tools.drawAndSend(e,t);else{const s={type:"array",events:[]};await e.events.forEach(function(e){e.sendBack=!0,s.events.push({type:"delete",id:e.id,dontClear:!0}),"Pencil"===e.tool?_drawLine(e):Tools.drawAndSend(e,Tools.list[e.tool])}),Tools.addActionToHistoryRedo(s,!0)}break;case"line":_drawLine(e),Tools.addActionToHistoryRedo({type:"delete",id:e.id},!0);break;case"delete":t=Tools.list.Eraser,e.sendBack=!0,e.sendToRedo=!0;break;case"update":t=Tools.list.Selector,e.dontClear=!0;for(var o=JSON.parse(JSON.stringify(e)),n=0;n<o._children.length;n++)o._children[n].transform=e._children[n].old_transform,o._children[n].old_transform=e._children[n].transform;Tools.addActionToHistoryRedo(o,!0),console.log("TrackInsertDataToRedo\t",o);break;default:t=Tools.list[e.tool],Tools.addActionToHistoryRedo({type:"delete",id:e.id},!0)}"line"!==e.type&&"array"!==e.type&&Tools.drawAndSend(e,t),Tools.enableToolsEl("redo")}}return r.onclick=e,function(){e()}}(),Tools.redo=function(){const r=document.getElementById("redo");async function e(){if(!r.className.includes("disabled")&&(Tools.disableToolsEl("undo"),Tools.disableToolsEl("redo"),Tools.historyRedo.length)){var e=Tools.historyRedo.pop(),t=(0===Tools.historyRedo.length&&Tools.disableToolsEl("redo"),null);switch(e.sendBack=!0,e.type){case"array":if("delete"===e.events[0].type)t=Tools.list.Eraser,e.sendBack=!0,Tools.drawAndSend(e,t);else{const s={type:"array",events:[],dontClear:!0};await e.events.forEach(function(e){e.sendBack=!0,s.events.push({type:"delete",id:e.id}),"Pencil"===e.tool?_drawLine(e):Tools.drawAndSend(e,Tools.list[e.tool])}),Tools.addActionToHistory(s,!0)}break;case"line":_drawLine(e),Tools.addActionToHistory({type:"delete",id:e.id},!0);break;case"delete":t=Tools.list.Eraser,e.sendBack=!0;break;case"update":t=Tools.list.Selector,e.dontClear=!0;for(var o=JSON.parse(JSON.stringify(e)),n=0;n<o._children.length;n++)o._children[n].transform=e._children[n].old_transform,o._children[n].old_transform=e._children[n].transform;Tools.addActionToHistory(o,!0);break;default:t=Tools.list[e.tool],Tools.addActionToHistory({type:"delete",id:e.id},!0)}"line"!==e.type&&"array"!==e.type&&Tools.drawAndSend(e,t),Tools.enableToolsEl("undo")}}return r.onclick=e,function(){e()}}(),Tools.history=[],Tools.historyRedo=[],Tools.addActionToHistory=function(e,t){Tools.enableToolsEl("undo"),80===Tools.history.length&&Tools.history.shift(),!t&&1&&(Tools.disableToolsEl("redo"),Tools.historyRedo.splice(0,Tools.historyRedo.length)),Tools.history.push(e),0!=Tools.historyRedo.length&&Tools.enableToolsEl("redo")},Tools.addActionToHistoryRedo=function(e,t){Tools.enableToolsEl("redo"),80===Tools.historyRedo.length&&Tools.historyRedo.shift(),!t&&1&&(Tools.disableToolsEl("undo"),Tools.historyRedo.splice(0,Tools.historyRedo.length)),Tools.historyRedo.push(e),0!=Tools.history.length&&Tools.enableToolsEl("undo")},Tools.svg.width.baseVal.value=document.body.clientWidth,Tools.svg.height.baseVal.value=document.body.clientHeight,function(){var t={top:0,scroll:0},o=document.getElementById("menu");function n(e){e=e.clientY-t.scroll;o.scrollTop=t.top-e}function s(e){o.removeEventListener("mousemove",n),document.removeEventListener("mouseup",s)}o.addEventListener("mousedown",function(e){t={top:o.scrollTop,scroll:e.clientY},o.addEventListener("mousemove",n),document.addEventListener("mouseup",s)})}(),function(){var r=null,a=!1,l=performance.now();function i(e,t){this.type="update",this.id=r.id,this.x2=e,this.y2=t}function o(e,t,o){var n,s;o&&(a=o.shiftKey,o.preventDefault()),null!==r&&(a&&(o=Math.atan2(t-r.y,e-r.x),n=Math.hypot(t-r.y,e-r.x),s=2*Math.PI/16,o=Math.round(o/s)*s,e=r.x+n*Math.cos(o),t=r.y+n*Math.sin(o)),50<performance.now()-l?(Tools.drawAndSend(new i(e,t)),l=performance.now()):c(new i(e,t)))}function c(e){switch(e.type){case"straight":n(e);break;case"update":var t=d.getElementById(e.id);t||(console.error("Straight line: Hmmm... I received a point of a line that has not been created (%s).",e.id),n({id:e.id,x:e.x2,y:e.y2,transform:`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`})),o=e,(t=t).x2.baseVal.value=o.x2,t.y2.baseVal.value=o.y2,o.transform&&t.setAttribute("transform",`matrix(${o.transform.a},${o.transform.b},${o.transform.c},${o.transform.d},${o.transform.e},${o.transform.f})`);break;default:console.error("Straight Line: Draw instruction with unknown type. ",e)}var o}var d=Tools.svg;function n(e){var t,o,n=d.getElementById(e.id)||Tools.createSVGElement("line"),s=e.color||"black";e.dotted&&n.classList.add("dotted"),e.arrow&&(o="m-"+(t=s),document.getElementById(o)||(o=`<marker id="${o}"  viewBox="0 0 10 10" refX="7.7" refY="5"
                        fill="${t}"
						markerUnits="strokeWidth"  orient="auto"
						markerWidth="5" markerHeight="5">
					<polyline points="0 0 10 5 0 10 0 5" />
				</marker>`,u.insertAdjacentHTML("beforeend",o)),n.style=`marker-end: url(#m-${s});`),n.id=e.id,n.x1.baseVal.value=e.x,n.y1.baseVal.value=e.y,n.x2.baseVal.value=e.x2||e.x,n.y2.baseVal.value=e.y2||e.y,n.setAttribute("stroke",s),n.setAttribute("stroke-width",e.size||10),n.setAttribute("opacity",Math.max(.1,Math.min(1,e.opacity))||1),e.transform&&n.setAttribute("transform",`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`),Tools.drawingArea.appendChild(n)}const u=document.getElementById("defs");Tools.add({name:"Arrow Line",shortcut:"gl",listeners:{press:function(e,t,o){o&&o.preventDefault(),r={type:"straight",id:Tools.generateUID("s"),color:Tools.getColor(),size:Tools.getSize(),opacity:Tools.getOpacity(),x:e,y:t,arrow:!0},Tools.drawAndSend(r)},move:o,release:function(e,t){o(e,t),r&&Tools.addActionToHistory({type:"delete",id:r.id}),r=null}},draw:c,mouseCursor:"crosshair",icon:"tools/arrow/arrow.svg"})}(),function(){var t=Tools.server_config.MAX_EMIT_COUNT_PERIOD/Tools.server_config.MAX_EMIT_COUNT*2,o=5e3,n=0,s=!0,r={name:"Cursor",listeners:{press:function(){s=!1},move:function(e,t){a.x=e,a.y=t,a.color=Tools.getColor(),a.size=Tools.getSize(),l()},release:function(){s=!0}},onSizeChange:function(e){a.size=e,l()},draw:d,mouseCursor:"crosshair",icon:"tools/pencil/icon.svg"},a=(Tools.register(r),Tools.addToolListeners(r),{type:"update",x:0,y:0,color:Tools.getColor(),size:Tools.getSize()});function l(){var e;Tools.showMarker&&Tools.showMyCursor&&(e=Date.now(),t<e-n&&(s||Tools.curTool.showMarker)?(Tools.drawAndSend(a,r),n=e):d(a))}var i=Tools.svg.getElementById("cursors");function c(e){return document.getElementById(e)||(e=e,(t=document.createElementNS("http://www.w3.org/2000/svg","circle")).setAttributeNS(null,"class","opcursor"),t.setAttributeNS(null,"id",e),t.setAttributeNS(null,"cx",0),t.setAttributeNS(null,"cy",0),t.setAttributeNS(null,"r",10),i.appendChild(t),setTimeout(function(){i.removeChild(t)},o),t);var t}function d(e){var t=c("cursor-"+(e.socket||"me"));t.style.transform="translate("+e.x+"px, "+e.y+"px)",Tools.isIE&&t.setAttributeNS(null,"transform","translate("+e.x+" "+e.y+")"),t.setAttributeNS(null,"fill",e.color),t.setAttributeNS(null,"r",e.size/2)}}(),function(){var s=!1;var r={type:"delete",id:"",sendBack:!0};function n(e,t,o){var n=o.target;"touchmove"===o.type&&(o=o.touches[0],n=document.elementFromPoint(o.clientX,o.clientY)),s&&n!==Tools.svg&&n!==Tools.drawingArea&&(o=n,Tools.drawingArea.contains(o))&&(r.id=n.id,Tools.drawAndSend(r))}var o=Tools.svg;Tools.add({name:"Eraser",shortcut:"e",listeners:{press:function(e,t,o){o.preventDefault(),s=!0,n(0,0,o)},move:n,release:function(){s=!1}},draw:function(e){var t;switch(e.type){case"array":e.events.forEach(function(e){null===(t=o.getElementById(e.id))?console.error("Eraser: Tried to delete an element that does not exist."):Tools.drawingArea.removeChild(t)});break;case"delete":null===(t=o.getElementById(e.id))?console.error("Eraser: Tried to delete an element that does not exist."):Tools.drawingArea.removeChild(t);break;case"clearBoard":Tools.historyRedo.splice(0,Tools.historyRedo.length),Tools.history.splice(0,Tools.history.length),Tools.disableToolsEl("undo"),Tools.disableToolsEl("redo"),Tools.change("Hand"),Tools.drawingArea.innerHTML="";break;default:console.error("Eraser: 'delete' instruction with unknown type. ",e)}},icon:"tools/eraser/icon.svg",mouseCursor:"crosshair",showMarker:!0})}(),function(){var t=1,o=["none","url(#grid)","url(#dots)"];(r=Tools.createSVGElement("pattern",{id:"smallGrid",width:"30",height:"30",patternUnits:"userSpaceOnUse"})).appendChild(Tools.createSVGElement("path",{d:"M 30 0 L 0 0 0 30",fill:"none",stroke:"gray","stroke-width":"0.5"})),(e=Tools.createSVGElement("pattern",{id:"grid",width:"30",height:"30",patternUnits:"userSpaceOnUse"})).appendChild(Tools.createSVGElement("rect",{width:"30",height:"30",fill:"url(#smallGrid)"})),e.appendChild(Tools.createSVGElement("path",{d:"M 30 0 L 0 0 0 30",fill:"none",stroke:"gray","stroke-width":"1"})),(n=Tools.createSVGElement("pattern",{id:"dots",width:"30",height:"30",x:"-10",y:"-10",patternUnits:"userSpaceOnUse"})).appendChild(Tools.createSVGElement("circle",{fill:"gray",cx:"10",cy:"10",r:"2"})),(s=Tools.svg.getElementById("defs")).appendChild(r),s.appendChild(e),s.appendChild(n),r=Tools.createSVGElement("rect",{id:"gridContainer",width:"100%",height:"100%",fill:o[t]}),Tools.svg.insertBefore(r,Tools.drawingArea);var e,n,s,r,a=r;Tools.add({name:"Grid",shortcut:"g",listeners:{},icon:"tools/grid/icon.svg",oneTouch:!0,onstart:function(e){t=(t+1)%o.length,a.setAttributeNS(null,"fill",o[t])},mouseCursor:"crosshair"})}(),function(){var s=null;function r(e,t,o,n){o=o,n=n,s&&!n&&window.scrollTo(s.x-o.clientX,s.y-o.clientY)}Tools.add({name:"Hand",shortcut:"h",listeners:{press:function(e,t,o,n){o=o,n||(s={x:document.documentElement.scrollLeft+o.clientX,y:document.documentElement.scrollTop+o.clientY})},move:r,release:function(e,t,o,n){r(0,0,o,n),s=null}},icon:"tools/hand/hand.svg",draw:function(e){if("update"!==e.type)throw new Error("Mover: 'move' instruction with unknown type. ",e);var t=Tools.svg.getElementById(e.id);if(t){var o,n=function(e){for(var t=null,o=0;o<e.transform.baseVal.numberOfItems;++o){var n=e.transform.baseVal[o];if(n.type===SVGTransform.SVG_TRANSFORM_MATRIX){t=n;break}}return null===t&&(t=e.transform.baseVal.createSVGTransformFromMatrix(Tools.svg.createSVGMatrix()),e.transform.baseVal.appendItem(t)),t.matrix}(t);for(o in e.transform)n[o]=e.transform[o]}},mouseCursor:"move",showMarker:!0})}(),function(){var r=null,a=!1,l=performance.now();function i(e,t){this.type="update",this.id=r.id,this.x2=e,this.y2=t}function o(e,t,o){var n,s;o&&(a=o.shiftKey,o.preventDefault()),null!==r&&(a&&(o=Math.atan2(t-r.y,e-r.x),n=Math.hypot(t-r.y,e-r.x),s=2*Math.PI/16,o=Math.round(o/s)*s,e=r.x+n*Math.cos(o),t=r.y+n*Math.sin(o)),70<performance.now()-l?(Tools.drawAndSend(new i(e,t)),l=performance.now()):c(new i(e,t)))}function c(e){switch(e.type){case"straight":s(e);break;case"update":var t=n.getElementById(e.id);t||(console.error("Straight line: Hmmm... I received a point of a line that has not been created (%s).",e.id),s({id:e.id,x:e.x2,y:e.y2,transform:`matrix(${lineData.transform.a},${lineData.transform.b},${lineData.transform.c},${lineData.transform.d},${lineData.transform.e},${lineData.transform.f})`})),o=e,(t=t).x2.baseVal.value=o.x2,t.y2.baseVal.value=o.y2;break;default:console.error("Straight Line: Draw instruction with unknown type. ",e)}var o}var n=Tools.svg;function s(e){var t=n.getElementById(e.id)||Tools.createSVGElement("line");e.dotted&&t.classList.add("dotted"),t.id=e.id,t.x1.baseVal.value=e.x,t.y1.baseVal.value=e.y,t.x2.baseVal.value=e.x2||e.x,t.y2.baseVal.value=e.y2||e.y,t.setAttribute("stroke",e.color||"black"),t.setAttribute("stroke-width",e.size||10),t.setAttribute("opacity",Math.max(.1,Math.min(1,e.opacity))||1),e.transform&&t.setAttribute("transform",`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`),Tools.drawingArea.appendChild(t)}Tools.add({name:"Straight line",shortcut:"l",listeners:{press:function(e,t,o){o.preventDefault(),r={type:"straight",id:Tools.generateUID("s"),color:Tools.getColor(),size:Tools.getSize(),opacity:Tools.getOpacity(),x:e,y:t,dotted:Tools.curTool.secondary.active},Tools.drawAndSend(r)},move:o,release:function(e,t){o(e,t),r&&Tools.addActionToHistory({type:"delete",id:r.id}),r=null}},secondary:{name:"Dotted line",icon:"tools/line/icon-straight.svg",active:!1},draw:c,mouseCursor:"crosshair",icon:"tools/line/icon.svg",stylesheet:"tools/line/line.css"})}(),function(){var n="",s=performance.now();function r(e,t){this.type="child",this.parent=n,this.x=e,this.y=t}function a(e,t,o){o&&o.preventDefault(),""!==n&&50<performance.now()-s&&(Tools.drawAndSend(new r(e,t)),s=performance.now())}var l={};var i={};var c=Tools.svg;function d(e){var t=c.getElementById(e.id)||Tools.createSVGElement("path");return e.dotted&&t.classList.add("dotted"),t.id=e.id,t.setAttribute("stroke",e.color||"black"),t.setAttribute("stroke-width",e.size||10),t.setAttribute("opacity",Math.max(.1,Math.min(1,e.opacity))||1),e.transform&&t.setAttribute("transform",`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`),Tools.drawingArea.appendChild(t),t}Tools.add({name:"Pencil",shortcut:"p",listeners:{press:function(e,t,o){o.preventDefault(),n=Tools.generateUID("l"),Tools.drawAndSend({type:"line",id:n,color:Tools.getColor(),size:Tools.getSize(),opacity:Tools.getOpacity(),dotted:Tools.curTool.secondary.active}),a(e,t)},move:a,release:function(e,t){a(e,t),n&&Tools.addActionToHistory({type:"delete",id:n}),n=""}},secondary:{name:"Dotted Pencil",icon:"tools/line/icon-straight.svg",active:!1},draw:function(e){switch(Tools.drawingEvent=!0,e.type){case"line":l=d(e),i[e.id]="";break;case"child":var t=l.id===e.parent?l:c.getElementById(e.parent);t||(console.error("Pencil: Hmmm... I received a point of a line that has not been created (%s).",e.parent),t=l=d({id:e.parent,transform:`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`})),t=t,o=e.x,n=e.y,s=function(e){var t=i[e.id];t||(t=e.getPathData(),i[e.id]=t);return t}(t),s=wboPencilPoint(s,o,n),t.setPathData(s);break;case"endline":break;default:console.error("Pencil: Draw instruction with unknown type. ",e)}var o,n,s},mouseCursor:"url('tools/pencil/cursor.svg'), crosshair",icon:"tools/pencil/icon.svg",stylesheet:"tools/pencil/pencil.css"})}(),function(){"use strict";function d(e,t,o,n){return Math.hypot(o-e,n-t)}function u(e,t){this.type=e,this.values=t}("object"===typeof module&&module.exports||window).wboPencilPoint=function(e,t,o){var n;switch(e.length){case 0:e.push(new u("M",[t,o])),n=new u("L",[t,o]);break;case 1:e.push(new u("L",[e[0].values[0],e[0].values[1]]));case 2:n=new u("C",[e[0].values[0],e[0].values[1],t,o,t,o]);break;default:n=function(e,t,o){var n,s,r,a=e[e.length-1].values,e=e[e.length-2].values,l=a[a.length-2],i=a[a.length-1],c=e[e.length-2],e=e[e.length-1];if(!(l===t&&i===o||c===t&&e===o))return r=t-c,n=o-e,s=Math.hypot(r,n),c=d(c,e,l,i)/s,e=d(t,o,l,i)/s,s=l-c*(r/=3),c=i-c*(n/=3),l=l+e*r,r=i+e*n,a[2]=s,a[3]=c,new u("C",[l,r,t,o,t,o])}(e,t,o)}return n&&e.push(n),e}}(),function(){var n,r,a={pointing:0,selecting:1,transform:2,add:3,remove:4,rotate:5},l=!1,c=null,d=[],u=[],h=x(),m=null,f=[],p=[],v=a.pointing,y=!1,o=0,e=Tools.server_config.BLOCKED_SELECTION_BUTTONS,T=[w(0,"delete",24,24,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0],e.y.baseVal.value=t.r[1]-(e.origHeight+3)/o,e.style.display=""},t),w(0,"duplicate",24,24,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+(e.origWidth+2)/o,e.y.baseVal.value=t.r[1]-(e.origHeight+3)/o,e.style.display=""},s),w(0,"handle",14,14,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+t.a[0]-e.origWidth/(2*o),e.y.baseVal.value=t.r[1]+t.b[1]-e.origHeight/(2*o),e.style.display=""},function(e,t,o){o.preventDefault(),0==u.length&&(u=d.map((e,t)=>{var o=L(e);return{type:"update",id:e.id,transform:{a:o.a,b:o.b,c:o.c,d:o.d,e:o.e,f:o.f}}}));E(),v=a.transform;o=h.transformedBBox(),c={x:o.r[0],y:o.r[1],w:o.a[0],h:o.b[1]},f=d.map(function(e){e=L(e);return{a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:e.f}}),p=f.map(e=>{return matInverse([[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]])}),o=L(h);r={a:o.a,d:o.d,e:o.e,f:o.f},m=A}),w(0,"add",24,24,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+(2*e.origWidth+2)/o,e.y.baseVal.value=t.r[1]-(e.origHeight+3)/o,e.style.display=""},function(){v=a.add}),w(0,"remove",24,24,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+(3*e.origWidth+2)/o,e.y.baseVal.value=t.r[1]-(e.origHeight+3)/o,e.style.display=""},function(){v=a.remove}),w(0,"mover",24,24,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+(4*e.origWidth+2)/o,e.y.baseVal.value=t.r[1]-(e.origHeight+3)/o,e.style.display=""},_),w(0,"rotate",14,14,function(e,t,o){e.width.baseVal.value=e.origWidth/o,e.height.baseVal.value=e.origHeight/o,e.x.baseVal.value=t.r[0]+t.a[0]-e.origWidth/(2*o),e.y.baseVal.value=t.r[1]-e.origHeight/(2*o),e.style.display=""},function(e,t,o){o.preventDefault(),0==u.length&&(u=d.map((e,t)=>{var o=L(e);return{type:"update",id:e.id,transform:{a:o.a,b:o.b,c:o.c,d:o.d,e:o.e,f:o.f}}}));E(),v=a.transform;o=h.transformedBBox(),c={x:o.r[0],y:o.r[1],w:o.a[0],h:o.b[1]},n=[c.w/2,c.h/2],f=d.map(function(e){e=L(e);return{a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:e.f}}),p=f.map(e=>{return matInverse([[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]])}),o=L(h);r={a:o.a,d:o.d,e:o.e,f:o.f},m=S})];for(i in e)delete T[e[i]];var g=Tools.getScale;function b(e){for(var t,o=e,n=[];o;)n.unshift(o),o=o.parentElement;var s=n.find(function(e){return"MathElement"===e.getAttribute("class")});return(t=s&&"svg"===s.tagName?s:t)||e}function t(){const t={type:"array",events:[]};d.forEach(function(e){t.events.push({type:"delete",id:e.id})}),t.sendBack=!0,Tools.drawAndSend(t,Tools.list.Eraser),d=[],I()}function s(){if(v==a.pointing&&0!=d.length){for(var e=[],t=[],o=[],n=0;n<d.length;n++){var s=d[n].id;e[n]={type:"copy",id:s,newid:Tools.generateUID(s[0])},o[n]={type:"delete",id:e[n].newid},t[n]=s}Tools.drawAndSend({_children:e}),Tools.addActionToHistory({type:"array",events:o}),d=t.map(function(e){return Tools.svg.getElementById(e)})}}function x(){var e=Tools.createSVGElement("rect");return e.id="selectionRect",e.x.baseVal.value=0,e.y.baseVal.value=0,e.width.baseVal.value=0,e.height.baseVal.value=0,e.setAttribute("stroke","red"),e.setAttribute("stroke-width",1.5),e.setAttribute("vector-effect","non-scaling-stroke"),e.setAttribute("fill","none"),e.setAttribute("stroke-dasharray","5 5"),e.setAttribute("opacity",1),Tools.svg.appendChild(e),e}function w(e,t,o,n,s,r){t=Tools.createSVGElement("image",{href:"tools/hand/"+t+".svg",width:o,height:n});return t.style.display="none",t.origWidth=o,t.origHeight=n,t.drawCallback=s,t.clickCallback=r,Tools.svg.appendChild(t),t}function E(){for(var e=0;e<T.length;e++)T[e].style.display="none"}function I(){E(),h.style.display="none"}function _(e,t,o){o.preventDefault(),0==u.length&&(u=d.map((e,t)=>{var o=L(e);return{type:"update",id:e.id,transform:{a:o.a,b:o.b,c:o.c,d:o.d,e:o.e,f:o.f}}})),v=a.transform,m=k,c={x:e,y:t},d=d.filter(function(e){return null!==Tools.svg.getElementById(e.id)}),f=d.map(function(e){e=L(e);return{a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:e.f}});o=L(h);r={x:o.e,y:o.f},E()}function S(e,t){var a=c.x+c.w/2,l=c.y+c.h/2,e=[e-a,l-t],i=Math.atan2(e[1],e[0]),i=Math.atan2(n[1],n[0])-i,t=L(h),e={_children:d.map(function(e,t){var o=f[t],t=(matProduct(p[t],[[a],[l],[1]]),Math.cos(i)),n=Math.sin(i),s=-Math.sin(i),r=Math.cos(i),t=matProduct([[t,s,-a*Math.cos(i)+l*Math.sin(i)+a],[n,r,-a*Math.sin(i)-l*Math.cos(i)+l],[0,0,1]],[[o.a,o.c,o.e],[o.b,o.d,o.f],[0,0,1]]);return{type:"update",id:e.id,transform:{a:t[0][0],b:t[1][0],c:t[0][1],d:t[1][1],e:t[0][2],f:t[1][2]}}})},t=(t.a=Math.cos(i),t.b=Math.sin(i),t.c=-Math.sin(i),t.d=Math.cos(i),t.e=-a*Math.cos(i)+l*Math.sin(i)+a,t.f=-a*Math.sin(i)-l*Math.cos(i)+l,performance.now());70<t-o?(o=t,Tools.drawAndSend(e)):B(e),y=!0}function M(e){var t=document.querySelector("svg"),e=e.getBoundingClientRect(),o=t.getScreenCTM().inverse(),n=t.createSVGPoint(),t=t.createSVGPoint();return n.x=e.left,n.y=e.top,t.x=e.right,t.y=e.bottom,n=n.matrixTransform(o),t=t.matrixTransform(o),{r:[n.x,n.y],a:[t.x-n.x,0],b:[0,t.y-n.y]}}function k(e,t){var n=e-c.x,s=t-c.y,e={_children:d.map(function(e,t){var t=f[t],o=L(e);o.a,o.c,o.e,o.b,o.d,o.f;return{type:"update",id:e.id,transform:{a:t.a,b:t.b,c:t.c,d:t.d,e:n+t.e,f:s+t.f}}})},t=L(h),t=(t.e=n+r.x,t.f=s+r.y,performance.now());70<t-o?(o=t,Tools.drawAndSend(e)):B(e),y=!0}function A(e,t){var a=rx=(e-c.x)/c.w,l=ry=(t-c.y)/c.h,e={_children:d.map(function(e,t){var t=f[t],o=a,n=l,s=("text"==e.tagName&&(a=o=Math.abs(o)>Math.abs(n)?Math.abs(n)*a/Math.abs(a):Math.abs(o)*a/Math.abs(a),l=n=Math.abs(o)*l/Math.abs(l)),o),r=n,o=c.x*(1-o),n=c.y*(1-n),s=(t.a,t.c,t.e,t.b,t.d,t.f,matProduct([[s,0,o],[0,r,n],[0,0,1]],[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]));return{type:"update",id:e.id,transform:{a:s[0][0],b:s[1][0],c:s[0][1],d:s[1][1],e:s[0][2],f:s[1][2]}}})},t=(rx=a,ry=l,L(h)),t=(t.a=rx,t.d=ry,t.e=r.e+h.x.baseVal.value*(r.a-rx),t.f=r.f+h.y.baseVal.value*(r.d-ry),performance.now());70<t-o?(o=t,Tools.drawAndSend(e)):B(e),y=!0}function C(e,t,o){o.x.baseVal.value=Math.min(e,c.x),o.y.baseVal.value=Math.min(t,c.y),o.width.baseVal.value=Math.abs(e-c.x),o.height.baseVal.value=Math.abs(t-c.y)}function V(){var o,n,s,r,a,e;d.length&&(angle=0,o=[],s=n=1/0,a=r=0,d.map((e,t)=>{e=M(e);for(o=[[e.r[0],e.r[1]],[e.r[0]+e.a[0],e.r[1]+e.a[1]],[e.r[0]+e.b[0],e.r[1]+e.b[1]],[e.r[0]+e.a[0]+e.b[0],e.r[1]+e.a[1]+e.b[1]]],t=0;t<4;t++)n>o[t][0]&&(n=o[t][0]),s>o[t][1]&&(s=o[t][1]),r<o[t][0]&&(r=o[t][0]),a<o[t][1]&&(a=o[t][1])}),h.x.baseVal.value=n-20,h.y.baseVal.value=s-20,h.width.baseVal.value=r-n+40,h.height.baseVal.value=a-s+40,(e=L(h)).a=1,e.b=0,e.c=0,e.d=1,e.e=0,e.f=0)}function L(e){for(var t=null,o=0;o<e.transform.baseVal.numberOfItems;++o){var n=e.transform.baseVal[o];if(n.type===SVGTransform.SVG_TRANSFORM_MATRIX){t=n;break}}return null==t&&(t=e.transform.baseVal.createSVGTransformFromMatrix(Tools.svg.createSVGMatrix()),e.transform.baseVal.appendItem(t)),t.matrix}function B(e){if(e._children)batchCall(B,e._children);else switch(e.type){case"update":var t=Tools.svg.getElementById(e.id);if(!t)throw new Error("Mover: Tried to move an element that does not exist.");var o=L(t);for(i in e.transform)o[i]=e.transform[i];break;case"copy":t=Tools.svg.getElementById(e.id).cloneNode(!0);t.id=e.newid,Tools.drawingArea.appendChild(t);break;default:throw new Error("Mover: 'move' instruction with unknown type. ",e)}}function D(e,t,o){h=h||x();for(var n,s=0;s<T.length;s++)T[s].contains(o.target)&&(n=T[s]);n?n.clickCallback(e,t,o):pointInTransformedBBox([e,t],h.transformedBBox())?v!=a.remove&&(E(),_(e,t,o)):v!=a.add&&(Tools.drawingArea.contains(o.target)?(I(),d=[b(o.target)],v=a.transform,_(e,t,o)):(E(),e=e,t=t,o.preventDefault(),c={x:e,y:t},d=[],v=a.selecting,h.x.baseVal.value=e,h.y.baseVal.value=t,h.width.baseVal.value=0,h.height.baseVal.value=0,h.style.display="",(tmatrix=L(h)).e=0,tmatrix.f=0))}function H(e,t){if(v==a.selecting&&(d=function(){for(var e=h.transformedBBox(),t=Tools.drawingArea.children,o=[],n=0;n<t.length;n++)console.log(e,M(t[n])),transformedBBoxIntersects(e,M(t[n]))&&o.push(Tools.drawingArea.children[n]);return o}(),V(),(angle=0)==d.length)&&(I(),f=[]),v==a.transform&&(C(e,t,h),V()),0!=d.length){h.style.display="",V();for(var o=g(),n=h.transformedBBox(),s=0;s<T.length;s++)T[s].drawCallback(T[s],n,o)}y&&0!=u.length&&(u=u.map((e,t)=>{t=L(d[t]);return{...e,old_transform:{a:t.a,b:t.b,c:t.c,d:t.d,e:t.e,f:t.f}}}),Tools.addActionToHistory({_children:u,type:"update"})),v==a.add||v==a.remove?V():v=a.pointing}function z(e,t,o){var n,s;v==a.selecting?C(e,t,h):v==a.remove?pointInTransformedBBox([e,t],h.transformedBBox())&&(n=o,l)&&Tools.drawingArea.contains(n.target)&&(n=b(n.target),console.log(d),-1!=(s=d.indexOf(n))&&(d.splice(s,1),console.log("Remove",s,n,d),V()),0==d.length)&&I():v==a.transform&&m?m(e,t):v!=a.add||pointInTransformedBBox([e,t],h.transformedBBox())||(s=o,l&&Tools.drawingArea.contains(s.target)&&(s=b(s.target),-1==d.indexOf(s))&&(d.push(s),V(),console.log("Add",s)))}function N(e,t,o,n){z(e,t,o)}function P(e){"Delete"!=e.key||e.target.matches("input[type=text], textarea")||t()}function $(e){"d"!=e.key||e.target.matches("input[type=text], textarea")||s()}Tools.add({name:"Selector",shortcut:"h",listeners:{press:function(e,t,o,n){l=!0,D(e,t,o)},move:N,release:function(e,t,o,n){c&&c.x!=e&&c.y!=t&&N(e,t,o),H(e,t),c=null,y=l=!(u=[])}},onquit:function(){c=null,I(),window.removeEventListener("keydown",P),window.removeEventListener("keydown",$)},draw:B,icon:"tools/selector/selector.svg",mouseCursor:"move",showMarker:!0}),Tools.hideSelectionUI=I,Tools.change("Hand")}(),function(){var r=!1,a=!1,l=0,e=!1,i="",c={type:"update",id:"",x:0,y:0,x2:0,y2:0,index:l},d={x:0,y:0},u=performance.now();const t=[{icon:"icon.svg",name:"rectangle"},{icon:"icon-square.svg",name:"square"},{icon:"icon-ellipse.svg",name:"ellipse"},{icon:"icon-circle.svg",name:"circle"}];function o(e,t,o){var n,s;o&&(a=1===l||3===l||o.shiftKey,o.preventDefault()),0===c.index||1===c.index?""!==i&&(1!==l&&!a||(o=e-c.x,n=t-c.y,s=Math.max(Math.abs(o),Math.abs(n)),e=c.x+(0<o?s:-s),t=c.y+(0<n?s:-s)),c.x2=e,c.y2=t,50<performance.now()-u||r?(Tools.drawAndSend(c),u=performance.now()):m(c)):c.id&&(d.x=e,d.y=t,h())}function h(e){var t,o,n,s,r;c.id&&(3===l||a?(t=c.x,o=c.y,n=d.x-t,s=d.y-o,r=Math.max(Math.abs(n),Math.abs(s)),c.x2=t+(0<n?r:-r),c.y2=o+(0<s?r:-r)):(c.x2=d.x,c.y2=d.y),50<performance.now()-u||e?(Tools.drawAndSend(c),u=performance.now()):m(c))}function m(e){if(Tools.drawingEvent=!0,0===e.index||1===e.index)switch(e.type){case"rect":s(e);break;case"update":(t=n.getElementById(e.id))||(console.error("Straight shape: Hmmm... I received a point of a rect that has not been created (%s).",e.id),s({id:e.id,x:e.x2,y:e.y2,transform:`matrix(${e.transfrom.a},${e.transfrom.b},${e.transfrom.c},${e.transfrom.d},${e.transfrom.e},${e.transfrom.f})`})),f(t,e);break;default:console.error("Straight shape: Draw instruction with unknown type. ",e)}else switch(e.type){case"ellipse":s(e);break;case"update":var t;(t=n.getElementById(e.id))||(console.error("Ellipse: Hmmm... I received an update for a shape that has not been created (%s).",e.id),s({id:e.id,x:e.x2,y:e.y2,transform:`matrix(${e.transfrom.a},${e.transfrom.b},${e.transfrom.c},${e.transfrom.d},${e.transfrom.e},${e.transfrom.f})`})),f(t,e);break;default:console.error("Ellipse: Draw instruction with unknown type. ",e)}}var n=Tools.svg;function s(e){var t;0===e.index||1===e.index?((t=n.getElementById(e.id)||Tools.createSVGElement("rect")).id=e.id,f(t,e)):(f(t=n.getElementById(e.id)||Tools.createSVGElement("ellipse"),e),t.id=e.id),t.setAttribute("stroke",e.color||"black"),t.setAttribute("stroke-width",e.size||10),t.setAttribute("opacity",Math.max(.1,Math.min(1,e.opacity))||1),e.transform&&t.setAttribute("transform",`matrix(${e.transform.a},${e.transform.b},${e.transform.c},${e.transform.d},${e.transform.e},${e.transform.f})`),Tools.drawingArea.appendChild(t)}function f(e,t){0===t.index||1===t.index?(e.x.baseVal.value=Math.min(t.x2,t.x),e.y.baseVal.value=Math.min(t.y2,t.y),e.width.baseVal.value=Math.abs(t.x2-t.x),e.height.baseVal.value=Math.abs(t.y2-t.y)):(e.cx.baseVal.value=Math.round((t.x2+t.x)/2),e.cy.baseVal.value=Math.round((t.y2+t.y)/2),e.rx.baseVal.value=Math.abs(t.x2-t.x)/2,e.ry.baseVal.value=Math.abs(t.y2-t.y)/2)}Tools.add({name:"Shapes",shortcut:"rt",listeners:{press:function(e,t,o){o&&o.preventDefault(),0===l||1===l?(i=Tools.generateUID("r"),Tools.drawAndSend({type:"rect",id:i,color:Tools.getColor(),size:Tools.getSize(),opacity:Tools.getOpacity(),x:e,y:t,x2:e,y2:t,index:l}),c.id=i):(c.id=Tools.generateUID("e"),Tools.drawAndSend({type:"ellipse",id:c.id,color:Tools.getColor(),size:Tools.getSize(),opacity:Tools.getOpacity(),x:e,y:t,x2:e,y2:t,index:l}),c.id=c.id),c.x=e,c.y=t,c.index=l},move:o,release:function(e,t){0===l||1===l?(r=!0,o(e,t),r=!1,i&&Tools.addActionToHistory({type:"delete",id:i}),i=""):(d.x=e,d.y=t,h(!0),c.id&&Tools.addActionToHistory({type:"delete",id:c.id}),c.id="")}},onstart:function(){e=!0},draw:m,mouseCursor:"crosshair",icon:"tools/shapes/icon.svg",stylesheet:"tools/shapes/shapes.css"}),Tools.HTML.toggle("Shapes",t[0].name,"/tools/shapes/"+t[0].icon),document.getElementById("toolID-Shapes").addEventListener("click",function(){r=!0,e||(l=(l+1)%t.length),e=!1,Tools.HTML.toggle("Shapes",t[l].name,"/tools/shapes/"+t[l].icon)})}(),function(){var o=Tools.board,l=document.createElement("input"),i=(l.id="textToolInput",l.type="text",l.setAttribute("autocomplete","off"),{x:0,y:0,size:36,rawSize:16,oldSize:0,opacity:1,color:"#000",id:0,sentText:"",lastSending:0}),n=!1;function c(){n=!0,l.parentNode||o.appendChild(l),l.value="";i.x,document.documentElement.scrollLeft;var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=i.x*Tools.scale-document.documentElement.scrollLeft;e<t+250&&(t=Math.max(60,e-260)),l.style.left=t+"px",l.style.top=i.y*Tools.scale-document.documentElement.scrollTop+20+"px",l.focus(),l.addEventListener("keyup",r),l.addEventListener("blur",r),l.addEventListener("blur",s)}function d(){try{l.blur()}catch(e){}n=!1,s(),i.id&&Tools.addActionToHistory({type:"delete",id:i.id}),i.id=0,i.sentText="",l.value="",l.removeEventListener("keyup",r)}function s(){n||(l.style.top="-1000px")}function r(e){13===e.which?(i.y+=1.5*i.size,d(),c()):27===e.which&&d(),100<performance.now()-i.lastSending?i.sentText!==l.value&&(0===i.id&&(i.id=Tools.generateUID("t"),Tools.drawAndSend({type:"new",id:i.id,color:i.color,size:i.size,opacity:i.opacity,x:i.x,y:i.y})),Tools.drawAndSend({type:"update",id:i.id,txt:l.value.slice(0,280)}),i.sentText=l.value,i.lastSending=performance.now()):(clearTimeout(i.timeout),i.timeout=setTimeout(r,500,e))}Tools.add({name:"Text",shortcut:"t",listeners:{press:function(e,t,o,n){var s,r,a;o.target!==l&&("text"===o.target.tagName?(s=o.target,i.id=s.id,r=s.getBoundingClientRect(),a=(r.left+document.documentElement.scrollLeft)/Tools.scale,r=(r.top+r.height+document.documentElement.scrollTop)/Tools.scale,i.x=a,i.y=r,i.sentText=s.textContent,i.size=parseInt(s.getAttribute("font-size")),i.opacity=parseFloat(s.getAttribute("opacity")),i.color=s.getAttribute("fill"),c(),l.value=s.textContent):(i.rawSize=Tools.getSize(),i.size=parseInt(1.5*i.rawSize+12),i.opacity=Tools.getOpacity(),i.color=Tools.getColor(),i.x=e,i.y=t+i.size/2,d(),c()),o.preventDefault())}},onstart:function(){i.oldSize=Tools.getSize(),Tools.setSize(i.rawSize)},onquit:function(){d(),Tools.setSize(i.oldSize)},draw:function(e,t){switch(Tools.drawingEvent=!0,e.type){case"new":var o=e,n=Tools.createSVGElement("text");n.id=o.id,n.setAttribute("x",o.x),n.setAttribute("y",o.y),n.setAttribute("font-size",o.size),n.setAttribute("fill",o.color),n.setAttribute("opacity",Math.max(.1,Math.min(1,o.opacity))||1),o.transform&&n.setAttribute("transform",`matrix(${o.transform.a},${o.transform.b},${o.transform.c},${o.transform.d},${o.transform.e},${o.transform.f})`),o.txt&&(n.textContent=o.txt),Tools.drawingArea.appendChild(n);break;case"update":o=document.getElementById(e.id);if(null===o)return console.error("Text: Hmmm... I received text that belongs to an unknown text field"),!1;o.textContent=e.txt;break;default:console.error("Text: Draw instruction with unknown type. ",e)}},stylesheet:"tools/text/text.css",icon:"tools/text/icon.svg",mouseCursor:"text"})}(),function(){var r={scrollX:document.documentElement.scrollLeft,scrollY:document.documentElement.scrollTop,x:0,y:0,clientY:0,scale:1},s=!1,a=!1;function l(e,t){var o=e.scale,t=Tools.setScale(t);window.scrollTo(e.scrollX+e.x*(t-o),e.scrollY+e.y*(t-o))}var i=null;function c(e){cancelAnimationFrame(i),i=requestAnimationFrame(function(){l(r,e)})}function d(e,t,o,n){r.scrollX=document.documentElement.scrollLeft,r.scrollY=document.documentElement.scrollTop,r.x=e,r.y=t,r.clientY=u(o,n),r.scale=Tools.getScale()}function e(){a=!1}function t(t){return function(e){"Shift"===e.key&&(Tools.svg.style.cursor="zoom-"+(t?"out":"in"))}}function u(e,t){return(t?e.changedTouches[0]:e).clientY}Tools.board.addEventListener("wheel",function(e){e.preventDefault();var t,o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?30:e.deltaMode===WheelEvent.DOM_DELTA_PAGE?1e3:1,n=e.deltaX*o,o=e.deltaY*o;e.ctrlKey||Tools.curTool===h?(t=Tools.getScale(),d(e.pageX/t,e.pageY/t,e,!1),c((1-o/800)*Tools.getScale())):e.altKey?(t=e.shiftKey?1:5,Tools.setSize(Tools.getSize()-o/100*t)):e.shiftKey?window.scrollTo(document.documentElement.scrollLeft+o,document.documentElement.scrollTop+n):window.scrollTo(document.documentElement.scrollLeft+n,document.documentElement.scrollTop+o)},{passive:!1}),Tools.board.addEventListener("touchmove",function(e){var t,o,n,s=e.touches;2===s.length&&(o=s[0].clientX-s[1].clientX,n=s[0].clientY-s[1].clientY,t=(s[0].pageX+s[1].pageX)/2/Tools.getScale(),s=(s[0].pageY+s[1].pageY)/2/Tools.getScale(),o=Math.sqrt(o*o+n*n),a?(n=o-r.distance,c(r.scale*(1+.5*n/100))):(d(t,s,e,a=!0),r.distance=o))},{passive:!0}),Tools.board.addEventListener("touchend",e),Tools.board.addEventListener("touchcancel",e);var o=t(!0),n=t(!1);var h={name:"Zoom",shortcut:"z",listeners:{press:function(e,t,o,n){o.preventDefault(),d(e,t,o,n),a=!(s=!1)},move:function(e,t,o,n){a&&(o.preventDefault(),o=u(o,n)-r.clientY,n=r.scale*(1+.5*o/100),1<Math.abs(o)&&(s=!0),i=c(n))},release:function(e,t,o,n){a&&!s&&(o=!0===o.shiftKey?-1:1,o=Tools.getScale()*(1+.5*o),l(r,o)),a=!1}},onstart:function(){window.addEventListener("keydown",o),window.addEventListener("keyup",n)},onquit:function(){window.removeEventListener("keydown",o),window.removeEventListener("keyup",n)},mouseCursor:"zoom-in",icon:"tools/zoom/icon.svg",helpText:"click_to_zoom",showMarker:!0};Tools.add(h)}();